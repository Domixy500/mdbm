var mdbm=function(e){"use strict";function t(){libByName("Object"),libByName("mdbm.Type")}function n(e){return libByName("mdbm.Type").entries().find(t=>t.field("Name")===e)}function s(e){return void 0!==n(e)}function i(e){return!s(e)}const o={alreadyExists:function(e){return"Type '"+e+"' does already exist!"},isMissing:function(e){return"Type '"+e+"' does not exist!"}};function c(e,t){e.field("hasTypes").map(e=>e.field("Name")).includes(t)||e.link("hasTypes",n(t))}const r={open:function(e){e.set("hasTypes",n("Object"))},post:function(e){return c(e,"Object"),c(e,e.field("Name")),e}};const f={check:function(e){if(i(e))throw o.isMissing(e)},create:function(e,t){if(s(e))throw o.existsAlready(e);return function(e,t){const n=libByName("mdbm.Type").create({});n.set("Name",e),void 0===t?r.open(n):n.set("hasTypes",t.field("hasTypes"));return r.post(n),n}(e,t)},emptyIds:function(e){const t=n(e).field("hasTypes").map(e=>e.field("Name")),s=Object.create(null);return t.forEach(e=>s[e]=null),s},isMissing:i,messages:o,onCreate:r},u={post:function(e){t(),f.isMissing(e.title)&&message("Type '"+e.title+"' is not defined!")}};const a={onOpen:u},l={parse:m,stringify:function(e){return JSON.stringify(e,null,2)}},m=JSON.parse;function p(e){return e.field("mdbm.Type")}const d={get:function(e,t){return y(e)[t]},getAll:y,set:g,setAll:b,setEmpty:function(e){const t=f.emptyIds(p(e));b(e,t)},setSelf:function(e){g(e,p(e),e.id)}};function y(e){return l.parse(e.field("mdbm.Ids"))}function b(e,t){e.set("mdbm.Ids",l.stringify(t))}function g(e,t,n){const s=y(e);s[t]=n,b(s)}const T={open:function(e,t){const n=t.title;if(f.isMissing(n))throw t.show(),f.messages.isMissing(n);e.set("mdbm.Type",n),d.setEmpty(e)},post:function(e){d.setSelf(e)}};const h={create:function(e){const t=libByName(e).create({});T.open(t,libByName(e)),T.post(t),t.show()},onCreate:T};return e.library=a,e.object=h,e.type=f,e}({});
